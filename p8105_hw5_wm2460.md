p8105_hw5_wm2460
================
Wenyan Ma

## Problem 1

## Problem 2

``` r
homicides_df = read_csv("./data/homicide-data.csv")
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

#### Describe the raw data

In the `homicides_df` dataset, there are 52179 observations and 12
variables. The variables in this dataset include uid, reported_date,
victim_last, victim_first, victim_race, victim_age, victim_sex, city,
state, lat, lon, disposition.

``` r
homicides_new = homicides_df %>% 
  janitor::clean_names() %>% 
  mutate(city_state = str_c(city, state, sep = "_"),
         status = 
           case_when(disposition == "Closed without arrest" ~ "unsolved",
                     disposition == "Open/No arrest" ~ "unsolved",
                     disposition == "Closed by arrest" ~ "resolved")) 

summarize_df = homicides_new %>% 
  group_by(city_state) %>% 
  summarize(total = n(),
            unsolved = sum(status == "unsolved")) 

summarize_df
```

    ## # A tibble: 51 × 3
    ##    city_state     total unsolved
    ##    <chr>          <int>    <int>
    ##  1 Albuquerque_NM   378      146
    ##  2 Atlanta_GA       973      373
    ##  3 Baltimore_MD    2827     1825
    ##  4 Baton Rouge_LA   424      196
    ##  5 Birmingham_AL    800      347
    ##  6 Boston_MA        614      310
    ##  7 Buffalo_NY       521      319
    ##  8 Charlotte_NC     687      206
    ##  9 Chicago_IL      5535     4073
    ## 10 Cincinnati_OH    694      309
    ## # … with 41 more rows

#### Using `prop.test` for Baltimore, MD

``` r
prop.test(summarize_df %>% filter(city_state == "Baltimore_MD") %>%
            pull(unsolved), 
          summarize_df %>% filter(city_state == "Baltimore_MD") %>%
            pull(total)) %>% 
  broom::tidy()
```

    ## # A tibble: 1 × 8
    ##   estimate statistic  p.value parameter conf.low conf.high method        alter…¹
    ##      <dbl>     <dbl>    <dbl>     <int>    <dbl>     <dbl> <chr>         <chr>  
    ## 1    0.646      239. 6.46e-54         1    0.628     0.663 1-sample pro… two.si…
    ## # … with abbreviated variable name ¹​alternative

``` r
# save the output of prop.test as an R object
prop.test(summarize_df %>% filter(city_state == "Baltimore_MD") %>%
            pull(unsolved), 
          summarize_df %>% filter(city_state == "Baltimore_MD") %>%
            pull(total)) %>% 
  broom::tidy() %>% 
  saveRDS(., "./data/Baltimore_prop_test.rds")
```

#### Using `prop.test` for each cities

``` r
all_cities = summarize_df %>% 
  mutate(prop_tests = map2(.x = unsolved, .y = total, ~ prop.test(x = .x, n = .y)),
         tidy_df = map(.x = prop_tests, ~ broom::tidy(.x))) %>% 
  select(-prop_tests) %>% 
  unnest(tidy_df) %>% 
  select(city_state, estimate, conf.low, conf.high)

all_cities
```

    ## # A tibble: 51 × 4
    ##    city_state     estimate conf.low conf.high
    ##    <chr>             <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque_NM    0.386    0.337     0.438
    ##  2 Atlanta_GA        0.383    0.353     0.415
    ##  3 Baltimore_MD      0.646    0.628     0.663
    ##  4 Baton Rouge_LA    0.462    0.414     0.511
    ##  5 Birmingham_AL     0.434    0.399     0.469
    ##  6 Boston_MA         0.505    0.465     0.545
    ##  7 Buffalo_NY        0.612    0.569     0.654
    ##  8 Charlotte_NC      0.300    0.266     0.336
    ##  9 Chicago_IL        0.736    0.724     0.747
    ## 10 Cincinnati_OH     0.445    0.408     0.483
    ## # … with 41 more rows

#### A plot that shows the estimates and CIs for each city

``` r
all_cities_plot = all_cities %>% 
  mutate(city_state = fct_reorder(city_state, estimate)) %>% 
  ggplot(aes(x = city_state, y = estimate)) +
  geom_point() +
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) + 
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

all_cities_plot
```

<img src="p8105_hw5_wm2460_files/figure-gfm/plot-1.png" width="90%" />

## Problem 3

#### Set up the simulation

``` r
sim_p3 = function(n = 30, mu = 0, sigma = 5) {
     x = rnorm(n, mean = mu, sd = sigma)
     t_test = t.test(x, conf.int = 0.95) %>% broom::tidy()
     
     t_test
}

p3_df = vector("list", 1000)

for (i in 1:1000) {
  p3_df[[i]] = sim_p3()
}

p3_df %>% 
  bind_rows() %>% 
  head()
```

    ## # A tibble: 6 × 8
    ##   estimate statistic p.value parameter conf.low conf.high method         alter…¹
    ##      <dbl>     <dbl>   <dbl>     <dbl>    <dbl>     <dbl> <chr>          <chr>  
    ## 1   0.695     0.808    0.426        29   -1.06       2.45 One Sample t-… two.si…
    ## 2   0.954     0.886    0.383        29   -1.25       3.16 One Sample t-… two.si…
    ## 3   0.736     0.778    0.443        29   -1.20       2.67 One Sample t-… two.si…
    ## 4  -0.479    -0.521    0.606        29   -2.36       1.40 One Sample t-… two.si…
    ## 5   0.0516    0.0632   0.950        29   -1.62       1.72 One Sample t-… two.si…
    ## 6   1.18      1.21     0.237        29   -0.818      3.17 One Sample t-… two.si…
    ## # … with abbreviated variable name ¹​alternative
